   1               		.file	"keyboard.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.keyboard_setup,"ax",@progbits
  11               	.global	keyboard_setup
  13               	keyboard_setup:
  14               	.LFB4:
  15               		.file 1 "../../tmk_core/common/keyboard.c"
   1:../../tmk_core/common/keyboard.c **** /*
   2:../../tmk_core/common/keyboard.c **** Copyright 2011,2012,2013 Jun Wako <wakojun@gmail.com>
   3:../../tmk_core/common/keyboard.c **** 
   4:../../tmk_core/common/keyboard.c **** This program is free software: you can redistribute it and/or modify
   5:../../tmk_core/common/keyboard.c **** it under the terms of the GNU General Public License as published by
   6:../../tmk_core/common/keyboard.c **** the Free Software Foundation, either version 2 of the License, or
   7:../../tmk_core/common/keyboard.c **** (at your option) any later version.
   8:../../tmk_core/common/keyboard.c **** 
   9:../../tmk_core/common/keyboard.c **** This program is distributed in the hope that it will be useful,
  10:../../tmk_core/common/keyboard.c **** but WITHOUT ANY WARRANTY; without even the implied warranty of
  11:../../tmk_core/common/keyboard.c **** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  12:../../tmk_core/common/keyboard.c **** GNU General Public License for more details.
  13:../../tmk_core/common/keyboard.c **** 
  14:../../tmk_core/common/keyboard.c **** You should have received a copy of the GNU General Public License
  15:../../tmk_core/common/keyboard.c **** along with this program.  If not, see <http://www.gnu.org/licenses/>.
  16:../../tmk_core/common/keyboard.c **** */
  17:../../tmk_core/common/keyboard.c **** #include <stdint.h>
  18:../../tmk_core/common/keyboard.c **** #include "keyboard.h"
  19:../../tmk_core/common/keyboard.c **** #include "matrix.h"
  20:../../tmk_core/common/keyboard.c **** #include "keymap.h"
  21:../../tmk_core/common/keyboard.c **** #include "host.h"
  22:../../tmk_core/common/keyboard.c **** #include "led.h"
  23:../../tmk_core/common/keyboard.c **** #include "keycode.h"
  24:../../tmk_core/common/keyboard.c **** #include "timer.h"
  25:../../tmk_core/common/keyboard.c **** #include "print.h"
  26:../../tmk_core/common/keyboard.c **** #include "debug.h"
  27:../../tmk_core/common/keyboard.c **** #include "command.h"
  28:../../tmk_core/common/keyboard.c **** #include "util.h"
  29:../../tmk_core/common/keyboard.c **** #include "sendchar.h"
  30:../../tmk_core/common/keyboard.c **** #include "bootmagic.h"
  31:../../tmk_core/common/keyboard.c **** #include "eeconfig.h"
  32:../../tmk_core/common/keyboard.c **** #include "backlight.h"
  33:../../tmk_core/common/keyboard.c **** #include "hook.h"
  34:../../tmk_core/common/keyboard.c **** #ifdef MOUSEKEY_ENABLE
  35:../../tmk_core/common/keyboard.c **** #   include "mousekey.h"
  36:../../tmk_core/common/keyboard.c **** #endif
  37:../../tmk_core/common/keyboard.c **** #ifdef PS2_MOUSE_ENABLE
  38:../../tmk_core/common/keyboard.c **** #   include "ps2_mouse.h"
  39:../../tmk_core/common/keyboard.c **** #endif
  40:../../tmk_core/common/keyboard.c **** #ifdef SERIAL_MOUSE_ENABLE
  41:../../tmk_core/common/keyboard.c **** #include "serial_mouse.h"
  42:../../tmk_core/common/keyboard.c **** #endif
  43:../../tmk_core/common/keyboard.c **** #ifdef ADB_MOUSE_ENABLE
  44:../../tmk_core/common/keyboard.c **** #include "adb.h"
  45:../../tmk_core/common/keyboard.c **** #endif
  46:../../tmk_core/common/keyboard.c **** 
  47:../../tmk_core/common/keyboard.c **** 
  48:../../tmk_core/common/keyboard.c **** #ifdef MATRIX_HAS_GHOST
  49:../../tmk_core/common/keyboard.c **** static bool has_ghost_in_row(uint8_t row)
  50:../../tmk_core/common/keyboard.c **** {
  51:../../tmk_core/common/keyboard.c ****     matrix_row_t matrix_row = matrix_get_row(row);
  52:../../tmk_core/common/keyboard.c ****     // No ghost exists when less than 2 keys are down on the row
  53:../../tmk_core/common/keyboard.c ****     if (((matrix_row - 1) & matrix_row) == 0)
  54:../../tmk_core/common/keyboard.c ****         return false;
  55:../../tmk_core/common/keyboard.c **** 
  56:../../tmk_core/common/keyboard.c ****     // Ghost occurs when the row shares column line with other row
  57:../../tmk_core/common/keyboard.c ****     for (uint8_t i=0; i < MATRIX_ROWS; i++) {
  58:../../tmk_core/common/keyboard.c ****         if (i != row && (matrix_get_row(i) & matrix_row))
  59:../../tmk_core/common/keyboard.c ****             return true;
  60:../../tmk_core/common/keyboard.c ****     }
  61:../../tmk_core/common/keyboard.c ****     return false;
  62:../../tmk_core/common/keyboard.c **** }
  63:../../tmk_core/common/keyboard.c **** #endif
  64:../../tmk_core/common/keyboard.c **** 
  65:../../tmk_core/common/keyboard.c **** 
  66:../../tmk_core/common/keyboard.c **** void keyboard_setup(void)
  67:../../tmk_core/common/keyboard.c **** {
  16               		.loc 1 67 1 view -0
  17               		.cfi_startproc
  18               	/* prologue: function */
  19               	/* frame size = 0 */
  20               	/* stack size = 0 */
  21               	.L__stack_usage = 0
  68:../../tmk_core/common/keyboard.c ****     matrix_setup();
  22               		.loc 1 68 5 view .LVU1
  23 0000 0C94 0000 		jmp matrix_setup
  24               	.LVL0:
  25               		.cfi_endproc
  26               	.LFE4:
  28               		.section	.text.keyboard_init,"ax",@progbits
  29               	.global	keyboard_init
  31               	keyboard_init:
  32               	.LFB5:
  69:../../tmk_core/common/keyboard.c **** }
  70:../../tmk_core/common/keyboard.c **** 
  71:../../tmk_core/common/keyboard.c **** void keyboard_init(void)
  72:../../tmk_core/common/keyboard.c **** {
  33               		.loc 1 72 1 view -0
  34               		.cfi_startproc
  35               	/* prologue: function */
  36               	/* frame size = 0 */
  37               	/* stack size = 0 */
  38               	.L__stack_usage = 0
  73:../../tmk_core/common/keyboard.c ****     timer_init();
  39               		.loc 1 73 5 view .LVU3
  40 0000 0E94 0000 		call timer_init
  41               	.LVL1:
  74:../../tmk_core/common/keyboard.c ****     matrix_init();
  42               		.loc 1 74 5 view .LVU4
  43 0004 0C94 0000 		jmp matrix_init
  44               	.LVL2:
  45               		.cfi_endproc
  46               	.LFE5:
  48               		.section	.text.keyboard_task,"ax",@progbits
  49               	.global	keyboard_task
  51               	keyboard_task:
  52               	.LFB6:
  75:../../tmk_core/common/keyboard.c **** #ifdef PS2_MOUSE_ENABLE
  76:../../tmk_core/common/keyboard.c ****     ps2_mouse_init();
  77:../../tmk_core/common/keyboard.c **** #endif
  78:../../tmk_core/common/keyboard.c **** #ifdef SERIAL_MOUSE_ENABLE
  79:../../tmk_core/common/keyboard.c ****     serial_mouse_init();
  80:../../tmk_core/common/keyboard.c **** #endif
  81:../../tmk_core/common/keyboard.c **** #ifdef ADB_MOUSE_ENABLE
  82:../../tmk_core/common/keyboard.c ****     adb_mouse_init();
  83:../../tmk_core/common/keyboard.c **** #endif
  84:../../tmk_core/common/keyboard.c **** 
  85:../../tmk_core/common/keyboard.c **** 
  86:../../tmk_core/common/keyboard.c **** #ifdef BOOTMAGIC_ENABLE
  87:../../tmk_core/common/keyboard.c ****     bootmagic();
  88:../../tmk_core/common/keyboard.c **** #endif
  89:../../tmk_core/common/keyboard.c **** 
  90:../../tmk_core/common/keyboard.c **** #ifdef BACKLIGHT_ENABLE
  91:../../tmk_core/common/keyboard.c ****     backlight_init();
  92:../../tmk_core/common/keyboard.c **** #endif
  93:../../tmk_core/common/keyboard.c **** }
  94:../../tmk_core/common/keyboard.c **** 
  95:../../tmk_core/common/keyboard.c **** /*
  96:../../tmk_core/common/keyboard.c ****  * Do keyboard routine jobs: scan matrix, light LEDs, ...
  97:../../tmk_core/common/keyboard.c ****  * This is repeatedly called as fast as possible.
  98:../../tmk_core/common/keyboard.c ****  */
  99:../../tmk_core/common/keyboard.c **** void keyboard_task(void)
 100:../../tmk_core/common/keyboard.c **** {
  53               		.loc 1 100 1 view -0
  54               		.cfi_startproc
  55 0000 8F92      		push r8
  56               	.LCFI0:
  57               		.cfi_def_cfa_offset 3
  58               		.cfi_offset 8, -2
  59 0002 9F92      		push r9
  60               	.LCFI1:
  61               		.cfi_def_cfa_offset 4
  62               		.cfi_offset 9, -3
  63 0004 AF92      		push r10
  64               	.LCFI2:
  65               		.cfi_def_cfa_offset 5
  66               		.cfi_offset 10, -4
  67 0006 BF92      		push r11
  68               	.LCFI3:
  69               		.cfi_def_cfa_offset 6
  70               		.cfi_offset 11, -5
  71 0008 DF92      		push r13
  72               	.LCFI4:
  73               		.cfi_def_cfa_offset 7
  74               		.cfi_offset 13, -6
  75 000a EF92      		push r14
  76               	.LCFI5:
  77               		.cfi_def_cfa_offset 8
  78               		.cfi_offset 14, -7
  79 000c FF92      		push r15
  80               	.LCFI6:
  81               		.cfi_def_cfa_offset 9
  82               		.cfi_offset 15, -8
  83 000e 0F93      		push r16
  84               	.LCFI7:
  85               		.cfi_def_cfa_offset 10
  86               		.cfi_offset 16, -9
  87 0010 1F93      		push r17
  88               	.LCFI8:
  89               		.cfi_def_cfa_offset 11
  90               		.cfi_offset 17, -10
  91 0012 CF93      		push r28
  92               	.LCFI9:
  93               		.cfi_def_cfa_offset 12
  94               		.cfi_offset 28, -11
  95 0014 DF93      		push r29
  96               	.LCFI10:
  97               		.cfi_def_cfa_offset 13
  98               		.cfi_offset 29, -12
  99 0016 00D0      		rcall .
 100 0018 00D0      		rcall .
 101 001a 0F92      		push __tmp_reg__
 102               	.LCFI11:
 103               		.cfi_def_cfa_offset 18
 104 001c CDB7      		in r28,__SP_L__
 105 001e DEB7      		in r29,__SP_H__
 106               	.LCFI12:
 107               		.cfi_def_cfa_register 28
 108               	/* prologue: function */
 109               	/* frame size = 5 */
 110               	/* stack size = 16 */
 111               	.L__stack_usage = 16
 101:../../tmk_core/common/keyboard.c ****     static matrix_row_t matrix_prev[MATRIX_ROWS];
 112               		.loc 1 101 5 view .LVU6
 102:../../tmk_core/common/keyboard.c **** #ifdef MATRIX_HAS_GHOST
 103:../../tmk_core/common/keyboard.c ****     static matrix_row_t matrix_ghost[MATRIX_ROWS];
 104:../../tmk_core/common/keyboard.c **** #endif
 105:../../tmk_core/common/keyboard.c ****     static uint8_t led_status = 0;
 113               		.loc 1 105 5 view .LVU7
 106:../../tmk_core/common/keyboard.c ****     matrix_row_t matrix_row = 0;
 114               		.loc 1 106 5 view .LVU8
 115               	.LVL3:
 107:../../tmk_core/common/keyboard.c ****     matrix_row_t matrix_change = 0;
 116               		.loc 1 107 5 view .LVU9
 108:../../tmk_core/common/keyboard.c **** 
 109:../../tmk_core/common/keyboard.c ****     matrix_scan();
 117               		.loc 1 109 5 view .LVU10
 118 0020 0E94 0000 		call matrix_scan
 119               	.LVL4:
 110:../../tmk_core/common/keyboard.c ****     for (uint8_t r = 0; r < MATRIX_ROWS; r++) {
 120               		.loc 1 110 5 view .LVU11
 121               	.LBB2:
 122               		.loc 1 110 10 view .LVU12
 123               		.loc 1 110 25 view .LVU13
 124 0024 80E0      		ldi r24,lo8(matrix_prev.2394)
 125 0026 A82E      		mov r10,r24
 126 0028 80E0      		ldi r24,hi8(matrix_prev.2394)
 127 002a B82E      		mov r11,r24
 128               		.loc 1 110 18 is_stmt 0 view .LVU14
 129 002c 10E0      		ldi r17,0
 130               	.LVL5:
 131               	.L9:
 111:../../tmk_core/common/keyboard.c ****         matrix_row = matrix_get_row(r);
 132               		.loc 1 111 9 is_stmt 1 view .LVU15
 133               		.loc 1 111 22 is_stmt 0 view .LVU16
 134 002e 812F      		mov r24,r17
 135 0030 0E94 0000 		call matrix_get_row
 136               	.LVL6:
 137 0034 F82E      		mov r15,r24
 138               	.LVL7:
 112:../../tmk_core/common/keyboard.c ****         matrix_change = matrix_row ^ matrix_prev[r];
 139               		.loc 1 112 9 is_stmt 1 view .LVU17
 140               		.loc 1 112 49 is_stmt 0 view .LVU18
 141 0036 F501      		movw r30,r10
 142 0038 D190      		ld r13,Z+
 143 003a 5F01      		movw r10,r30
 144               	.LVL8:
 113:../../tmk_core/common/keyboard.c ****         if (matrix_change) {
 145               		.loc 1 113 9 is_stmt 1 view .LVU19
 146               		.loc 1 113 12 is_stmt 0 view .LVU20
 147 003c D816      		cp r13,r24
 148 003e 01F0      		breq .L4
 149               	.LBB3:
 114:../../tmk_core/common/keyboard.c **** #ifdef MATRIX_HAS_GHOST
 115:../../tmk_core/common/keyboard.c ****             if (has_ghost_in_row(r)) {
 116:../../tmk_core/common/keyboard.c ****                 /* Keep track of whether ghosted status has changed for
 117:../../tmk_core/common/keyboard.c ****                  * debugging. But don't update matrix_prev until un-ghosted, or
 118:../../tmk_core/common/keyboard.c ****                  * the last key would be lost.
 119:../../tmk_core/common/keyboard.c ****                  */
 120:../../tmk_core/common/keyboard.c ****                 if (debug_matrix && matrix_ghost[r] != matrix_row) {
 121:../../tmk_core/common/keyboard.c ****                     matrix_print();
 122:../../tmk_core/common/keyboard.c ****                 }
 123:../../tmk_core/common/keyboard.c ****                 matrix_ghost[r] = matrix_row;
 124:../../tmk_core/common/keyboard.c ****                 continue;
 125:../../tmk_core/common/keyboard.c ****             }
 126:../../tmk_core/common/keyboard.c ****             matrix_ghost[r] = matrix_row;
 127:../../tmk_core/common/keyboard.c **** #endif
 128:../../tmk_core/common/keyboard.c ****             if (debug_matrix) matrix_print();
 150               		.loc 1 128 13 is_stmt 1 view .LVU21
 151               		.loc 1 128 17 is_stmt 0 view .LVU22
 152 0040 8091 0000 		lds r24,debug_config
 153               		.loc 1 128 16 view .LVU23
 154 0044 81FD      		sbrc r24,1
 155               		.loc 1 128 31 is_stmt 1 discriminator 1 view .LVU24
 156 0046 0E94 0000 		call matrix_print
 157               	.LVL9:
 158               	.L5:
 159               	.LBE3:
 112:../../tmk_core/common/keyboard.c ****         if (matrix_change) {
 160               		.loc 1 112 23 is_stmt 0 view .LVU25
 161 004a DF24      		eor r13,r15
 162               	.LVL10:
 112:../../tmk_core/common/keyboard.c ****         if (matrix_change) {
 163               		.loc 1 112 23 view .LVU26
 164 004c E12C      		mov r14,__zero_reg__
 165 004e 01E0      		ldi r16,lo8(1)
 166 0050 4501      		movw r8,r10
 167 0052 F1E0      		ldi r31,1
 168 0054 8F1A      		sub r8,r31
 169 0056 9108      		sbc r9,__zero_reg__
 170               	.L8:
 171               	.LVL11:
 172               	.LBB6:
 173               	.LBB4:
 129:../../tmk_core/common/keyboard.c ****             matrix_row_t col_mask = 1;
 130:../../tmk_core/common/keyboard.c ****             for (uint8_t c = 0; c < MATRIX_COLS; c++, col_mask <<= 1) {
 131:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 174               		.loc 1 131 17 is_stmt 1 view .LVU27
 175               		.loc 1 131 21 is_stmt 0 view .LVU28
 176 0058 8D2D      		mov r24,r13
 177 005a 8023      		and r24,r16
 178               		.loc 1 131 20 view .LVU29
 179 005c 01F0      		breq .L6
 180               	.LBB5:
 132:../../tmk_core/common/keyboard.c ****                     keyevent_t e = (keyevent_t){
 181               		.loc 1 132 21 is_stmt 1 view .LVU30
 182               		.loc 1 132 32 is_stmt 0 view .LVU31
 183 005e E982      		std Y+1,r14
 184 0060 1A83      		std Y+2,r17
 133:../../tmk_core/common/keyboard.c ****                         .key = (keypos_t){ .row = r, .col = c },
 134:../../tmk_core/common/keyboard.c ****                         .pressed = (matrix_row & col_mask),
 185               		.loc 1 134 48 view .LVU32
 186 0062 91E0      		ldi r25,lo8(1)
 187 0064 8F2D      		mov r24,r15
 188 0066 8023      		and r24,r16
 189 0068 01F4      		brne .L7
 190               		.loc 1 134 48 view .LVU33
 191 006a 90E0      		ldi r25,0
 192               	.L7:
 132:../../tmk_core/common/keyboard.c ****                     keyevent_t e = (keyevent_t){
 193               		.loc 1 132 32 view .LVU34
 194 006c 9B83      		std Y+3,r25
 135:../../tmk_core/common/keyboard.c ****                         .time = (timer_read() | 1) /* time should not be 0 */
 195               		.loc 1 135 34 view .LVU35
 196 006e 0E94 0000 		call timer_read
 197               	.LVL12:
 198               		.loc 1 135 47 view .LVU36
 199 0072 8160      		ori r24,1
 132:../../tmk_core/common/keyboard.c ****                     keyevent_t e = (keyevent_t){
 200               		.loc 1 132 32 view .LVU37
 201 0074 782F      		mov r23,r24
 202 0076 9D83      		std Y+5,r25
 203 0078 8C83      		std Y+4,r24
 136:../../tmk_core/common/keyboard.c ****                     };
 137:../../tmk_core/common/keyboard.c ****                     action_exec(e);
 204               		.loc 1 137 21 is_stmt 1 view .LVU38
 205 007a 4981      		ldd r20,Y+1
 206 007c 5A81      		ldd r21,Y+2
 207 007e 6B81      		ldd r22,Y+3
 208 0080 8D81      		ldd r24,Y+5
 209 0082 0E94 0000 		call action_exec
 210               	.LVL13:
 138:../../tmk_core/common/keyboard.c ****                     hook_matrix_change(e);
 211               		.loc 1 138 21 view .LVU39
 212 0086 4981      		ldd r20,Y+1
 213 0088 5A81      		ldd r21,Y+2
 214 008a 6B81      		ldd r22,Y+3
 215 008c 7C81      		ldd r23,Y+4
 216 008e 8D81      		ldd r24,Y+5
 217 0090 0E94 0000 		call hook_matrix_change
 218               	.LVL14:
 139:../../tmk_core/common/keyboard.c ****                     // record a processed key
 140:../../tmk_core/common/keyboard.c ****                     matrix_prev[r] ^= col_mask;
 219               		.loc 1 140 21 view .LVU40
 220               		.loc 1 140 36 is_stmt 0 view .LVU41
 221 0094 F401      		movw r30,r8
 222 0096 8081      		ld r24,Z
 223 0098 8027      		eor r24,r16
 224 009a 8083      		st Z,r24
 225               	.L6:
 226               		.loc 1 140 36 view .LVU42
 227               	.LBE5:
 130:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 228               		.loc 1 130 50 is_stmt 1 discriminator 2 view .LVU43
 130:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 229               		.loc 1 130 51 is_stmt 0 discriminator 2 view .LVU44
 230 009c E394      		inc r14
 231               	.LVL15:
 130:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 232               		.loc 1 130 64 discriminator 2 view .LVU45
 233 009e 000F      		lsl r16
 234               	.LVL16:
 130:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 235               		.loc 1 130 33 is_stmt 1 discriminator 2 view .LVU46
 130:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 236               		.loc 1 130 13 is_stmt 0 discriminator 2 view .LVU47
 237 00a0 F8E0      		ldi r31,lo8(8)
 238 00a2 EF12      		cpse r14,r31
 239 00a4 00C0      		rjmp .L8
 240               	.LVL17:
 241               	.L4:
 130:../../tmk_core/common/keyboard.c ****                 if (matrix_change & col_mask) {
 242               		.loc 1 130 13 discriminator 2 view .LVU48
 243               	.LBE4:
 244               	.LBE6:
 110:../../tmk_core/common/keyboard.c ****         matrix_row = matrix_get_row(r);
 245               		.loc 1 110 42 is_stmt 1 view .LVU49
 110:../../tmk_core/common/keyboard.c ****         matrix_row = matrix_get_row(r);
 246               		.loc 1 110 43 is_stmt 0 view .LVU50
 247 00a6 1F5F      		subi r17,lo8(-(1))
 248               	.LVL18:
 110:../../tmk_core/common/keyboard.c ****         matrix_row = matrix_get_row(r);
 249               		.loc 1 110 25 is_stmt 1 view .LVU51
 110:../../tmk_core/common/keyboard.c ****         matrix_row = matrix_get_row(r);
 250               		.loc 1 110 5 is_stmt 0 view .LVU52
 251 00a8 1131      		cpi r17,lo8(17)
 252 00aa 01F0      		breq .+2
 253 00ac 00C0      		rjmp .L9
 254               	.LBE2:
 141:../../tmk_core/common/keyboard.c **** 
 142:../../tmk_core/common/keyboard.c ****                     // This can miss stroke when scan matrix takes long like Topre
 143:../../tmk_core/common/keyboard.c ****                     // process a key per task call
 144:../../tmk_core/common/keyboard.c ****                     //goto MATRIX_LOOP_END;
 145:../../tmk_core/common/keyboard.c ****                 }
 146:../../tmk_core/common/keyboard.c ****             }
 147:../../tmk_core/common/keyboard.c ****         }
 148:../../tmk_core/common/keyboard.c ****     }
 149:../../tmk_core/common/keyboard.c ****     // call with pseudo tick event when no real key event.
 150:../../tmk_core/common/keyboard.c ****     action_exec(TICK);
 255               		.loc 1 150 5 is_stmt 1 view .LVU53
 256               		.loc 1 150 17 is_stmt 0 view .LVU54
 257 00ae 8FEF      		ldi r24,lo8(-1)
 258 00b0 8983      		std Y+1,r24
 259 00b2 8A83      		std Y+2,r24
 260 00b4 1B82      		std Y+3,__zero_reg__
 261 00b6 0E94 0000 		call timer_read
 262               	.LVL19:
 263 00ba 8160      		ori r24,1
 264 00bc 782F      		mov r23,r24
 265 00be 9D83      		std Y+5,r25
 266 00c0 8C83      		std Y+4,r24
 267               		.loc 1 150 5 view .LVU55
 268 00c2 4981      		ldd r20,Y+1
 269 00c4 5A81      		ldd r21,Y+2
 270 00c6 6B81      		ldd r22,Y+3
 271 00c8 8D81      		ldd r24,Y+5
 272 00ca 0E94 0000 		call action_exec
 273               	.LVL20:
 151:../../tmk_core/common/keyboard.c **** 
 152:../../tmk_core/common/keyboard.c **** //MATRIX_LOOP_END:
 153:../../tmk_core/common/keyboard.c **** 
 154:../../tmk_core/common/keyboard.c ****     hook_keyboard_loop();
 274               		.loc 1 154 5 is_stmt 1 view .LVU56
 275 00ce 0E94 0000 		call hook_keyboard_loop
 276               	.LVL21:
 155:../../tmk_core/common/keyboard.c **** 
 156:../../tmk_core/common/keyboard.c **** #ifdef MOUSEKEY_ENABLE
 157:../../tmk_core/common/keyboard.c ****     // mousekey repeat & acceleration
 158:../../tmk_core/common/keyboard.c ****     mousekey_task();
 159:../../tmk_core/common/keyboard.c **** #endif
 160:../../tmk_core/common/keyboard.c **** 
 161:../../tmk_core/common/keyboard.c **** #ifdef PS2_MOUSE_ENABLE
 162:../../tmk_core/common/keyboard.c ****     ps2_mouse_task();
 163:../../tmk_core/common/keyboard.c **** #endif
 164:../../tmk_core/common/keyboard.c **** 
 165:../../tmk_core/common/keyboard.c **** #ifdef SERIAL_MOUSE_ENABLE
 166:../../tmk_core/common/keyboard.c ****         serial_mouse_task();
 167:../../tmk_core/common/keyboard.c **** #endif
 168:../../tmk_core/common/keyboard.c **** 
 169:../../tmk_core/common/keyboard.c **** #ifdef ADB_MOUSE_ENABLE
 170:../../tmk_core/common/keyboard.c ****         adb_mouse_task();
 171:../../tmk_core/common/keyboard.c **** #endif
 172:../../tmk_core/common/keyboard.c **** 
 173:../../tmk_core/common/keyboard.c ****     // update LED
 174:../../tmk_core/common/keyboard.c ****     if (led_status != host_keyboard_leds()) {
 277               		.loc 1 174 5 view .LVU57
 278               		.loc 1 174 23 is_stmt 0 view .LVU58
 279 00d2 0E94 0000 		call host_keyboard_leds
 280               	.LVL22:
 281               		.loc 1 174 8 view .LVU59
 282 00d6 9091 0000 		lds r25,led_status.2395
 283 00da 8917      		cp r24,r25
 284 00dc 01F0      		breq .L3
 175:../../tmk_core/common/keyboard.c ****         led_status = host_keyboard_leds();
 285               		.loc 1 175 9 is_stmt 1 view .LVU60
 286               		.loc 1 175 22 is_stmt 0 view .LVU61
 287 00de 0E94 0000 		call host_keyboard_leds
 288               	.LVL23:
 289               		.loc 1 175 20 view .LVU62
 290 00e2 8093 0000 		sts led_status.2395,r24
 176:../../tmk_core/common/keyboard.c ****         if (debug_keyboard) dprintf("LED: %02X\n", led_status);
 291               		.loc 1 176 9 is_stmt 1 view .LVU63
 292               		.loc 1 176 29 view .LVU64
 293               		.loc 1 176 29 view .LVU65
 294 00e6 9091 0000 		lds r25,debug_config
 295 00ea 9570      		andi r25,lo8(5)
 296 00ec 9530      		cpi r25,lo8(5)
 297 00ee 01F4      		brne .L11
 298               		.loc 1 176 29 discriminator 3 view .LVU66
 299               	.LBB7:
 300               		.loc 1 176 29 discriminator 3 view .LVU67
 301               		.loc 1 176 29 discriminator 3 view .LVU68
 302               	.LBE7:
 303 00f0 1F92      		push __zero_reg__
 304 00f2 8F93      		push r24
 305 00f4 80E0      		ldi r24,lo8(__c.2412)
 306 00f6 90E0      		ldi r25,hi8(__c.2412)
 307 00f8 9F93      		push r25
 308 00fa 8F93      		push r24
 309 00fc 0E94 0000 		call __xprintf
 310               	.LVL24:
 311 0100 0F90      		pop __tmp_reg__
 312 0102 0F90      		pop __tmp_reg__
 313 0104 0F90      		pop __tmp_reg__
 314 0106 0F90      		pop __tmp_reg__
 315               	.L11:
 316               		.loc 1 176 29 discriminator 5 view .LVU69
 177:../../tmk_core/common/keyboard.c ****         hook_keyboard_leds_change(led_status);
 317               		.loc 1 177 9 discriminator 5 view .LVU70
 318 0108 8091 0000 		lds r24,led_status.2395
 319               	/* epilogue start */
 178:../../tmk_core/common/keyboard.c ****     }
 179:../../tmk_core/common/keyboard.c **** }
 320               		.loc 1 179 1 is_stmt 0 discriminator 5 view .LVU71
 321 010c 0F90      		pop __tmp_reg__
 322 010e 0F90      		pop __tmp_reg__
 323 0110 0F90      		pop __tmp_reg__
 324 0112 0F90      		pop __tmp_reg__
 325 0114 0F90      		pop __tmp_reg__
 326 0116 DF91      		pop r29
 327 0118 CF91      		pop r28
 328 011a 1F91      		pop r17
 329               	.LVL25:
 330               		.loc 1 179 1 discriminator 5 view .LVU72
 331 011c 0F91      		pop r16
 332 011e FF90      		pop r15
 333               	.LVL26:
 334               		.loc 1 179 1 discriminator 5 view .LVU73
 335 0120 EF90      		pop r14
 336 0122 DF90      		pop r13
 337 0124 BF90      		pop r11
 338 0126 AF90      		pop r10
 339 0128 9F90      		pop r9
 340 012a 8F90      		pop r8
 177:../../tmk_core/common/keyboard.c ****         hook_keyboard_leds_change(led_status);
 341               		.loc 1 177 9 discriminator 5 view .LVU74
 342 012c 0C94 0000 		jmp hook_keyboard_leds_change
 343               	.LVL27:
 344               	.L3:
 345               	/* epilogue start */
 346               		.loc 1 179 1 view .LVU75
 347 0130 0F90      		pop __tmp_reg__
 348 0132 0F90      		pop __tmp_reg__
 349 0134 0F90      		pop __tmp_reg__
 350 0136 0F90      		pop __tmp_reg__
 351 0138 0F90      		pop __tmp_reg__
 352 013a DF91      		pop r29
 353 013c CF91      		pop r28
 354 013e 1F91      		pop r17
 355               	.LVL28:
 356               		.loc 1 179 1 view .LVU76
 357 0140 0F91      		pop r16
 358 0142 FF90      		pop r15
 359               	.LVL29:
 360               		.loc 1 179 1 view .LVU77
 361 0144 EF90      		pop r14
 362 0146 DF90      		pop r13
 363 0148 BF90      		pop r11
 364 014a AF90      		pop r10
 365 014c 9F90      		pop r9
 366 014e 8F90      		pop r8
 367 0150 0895      		ret
 368               		.cfi_endproc
 369               	.LFE6:
 371               		.section	.text.keyboard_set_leds,"ax",@progbits
 372               	.global	keyboard_set_leds
 374               	keyboard_set_leds:
 375               	.LVL30:
 376               	.LFB7:
 180:../../tmk_core/common/keyboard.c **** 
 181:../../tmk_core/common/keyboard.c **** void keyboard_set_leds(uint8_t leds)
 182:../../tmk_core/common/keyboard.c **** {
 377               		.loc 1 182 1 is_stmt 1 view -0
 378               		.cfi_startproc
 379               	/* prologue: function */
 380               	/* frame size = 0 */
 381               	/* stack size = 0 */
 382               	.L__stack_usage = 0
 183:../../tmk_core/common/keyboard.c ****     led_set(leds);
 383               		.loc 1 183 5 view .LVU79
 384 0000 0C94 0000 		jmp led_set
 385               	.LVL31:
 386               		.loc 1 183 5 is_stmt 0 view .LVU80
 387               		.cfi_endproc
 388               	.LFE7:
 390               		.section	.progmem.data.__c.2412,"a"
 393               	__c.2412:
 394 0000 4C45 443A 		.string	"LED: %02X\n"
 394      2025 3032 
 394      580A 00
 395               		.section	.bss.led_status.2395,"aw",@nobits
 398               	led_status.2395:
 399 0000 00        		.zero	1
 400               		.section	.bss.matrix_prev.2394,"aw",@nobits
 403               	matrix_prev.2394:
 404 0000 0000 0000 		.zero	17
 404      0000 0000 
 404      0000 0000 
 404      0000 0000 
 404      00
 405               		.text
 406               	.Letext0:
 407               		.file 2 "/usr/avr/include/stdint.h"
 408               		.file 3 "../../tmk_core/common/keyboard.h"
 409               		.file 4 "../../tmk_core/common/matrix.h"
 410               		.file 5 "../../tmk_core/common/host.h"
 411               		.file 6 "../../tmk_core/common/timer.h"
 412               		.file 7 "../../tmk_core/common/avr/xprintf.h"
 413               		.file 8 "../../tmk_core/common/debug.h"
 414               		.file 9 "../../tmk_core/common/command.h"
 415               		.file 10 "../../tmk_core/common/led.h"
 416               		.file 11 "../../tmk_core/common/action.h"
 417               		.file 12 "../../tmk_core/common/hook.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 keyboard.c
     /tmp/cc5YkWkN.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/cc5YkWkN.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/cc5YkWkN.s:4      *ABS*:000000000000003f __SREG__
     /tmp/cc5YkWkN.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/cc5YkWkN.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/cc5YkWkN.s:13     .text.keyboard_setup:0000000000000000 keyboard_setup
     /tmp/cc5YkWkN.s:31     .text.keyboard_init:0000000000000000 keyboard_init
     /tmp/cc5YkWkN.s:51     .text.keyboard_task:0000000000000000 keyboard_task
     /tmp/cc5YkWkN.s:403    .bss.matrix_prev.2394:0000000000000000 matrix_prev.2394
     /tmp/cc5YkWkN.s:398    .bss.led_status.2395:0000000000000000 led_status.2395
     /tmp/cc5YkWkN.s:393    .progmem.data.__c.2412:0000000000000000 __c.2412
     /tmp/cc5YkWkN.s:374    .text.keyboard_set_leds:0000000000000000 keyboard_set_leds

UNDEFINED SYMBOLS
matrix_setup
timer_init
matrix_init
matrix_scan
matrix_get_row
debug_config
matrix_print
timer_read
action_exec
hook_matrix_change
hook_keyboard_loop
host_keyboard_leds
__xprintf
hook_keyboard_leds_change
led_set
__do_clear_bss
